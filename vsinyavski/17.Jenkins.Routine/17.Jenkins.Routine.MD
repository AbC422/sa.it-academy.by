## 17. Jenkins.Routine

### Parameters 
![image](https://raw.githubusercontent.com/astarosh87/sa.it-academy.by/md-sa2-17-21/vsinyavski/17.Jenkins.Routine/Parameters_jobs_jenkins.png)


+ ### Check connection to the host

```bash
Started by user asta
Running as SYSTEM
Building in workspace /var/lib/jenkins/workspace/vsinyavski/01.Task
[01.Task] $ ansible ubuntu -i /home/vit/Work/ansible/hosts.yaml -m ping -f 5
ubuntu | SUCCESS => {
    "ansible_facts": {
        "discovered_interpreter_python": "/usr/bin/python"
    },
    "changed": false,
    "ping": "pong"
}
[01.Task] $ ansible ubuntu -i /home/vit/Work/ansible/hosts.yaml -m shell -a "hostname && hostname -i" -f 5
ubuntu | CHANGED | rc=0 >>
sa-ubuntu-28
fe80::3028:20ff:fe68:d0d9%eth0 192.168.202.28
Finished: SUCCESS

Started by user asta
Running as SYSTEM
Building in workspace /var/lib/jenkins/workspace/vsinyavski/02.Task
[02.Task] $ /bin/sh -xe /tmp/jenkins17633101529020413653.sh
+ ssh root@192.168.202.28
Pseudo-terminal will not be allocated because stdin is not a terminal.
Welcome to Ubuntu 18.04.5 LTS (GNU/Linux 5.3.10-1-pve x86_64)

 * Documentation:  https://help.ubuntu.com
 * Management:     https://landscape.canonical.com
 * Support:        https://ubuntu.com/advantage

12 updates can be applied immediately.
To see these additional updates run: apt list --upgradable

You have new mail.
mesg: ttyname failed: Inappropriate ioctl for device
Finished: SUCCESS
```
---
+ ### Install/upgrade nmap

```bash
Started by user asta
Running as SYSTEM
Building in workspace /var/lib/jenkins/workspace/vsinyavski/03.Task
[03.Task] $ ansible ubuntu -i /home/vit/Work/ansible/hosts.yaml -m shell -a "apt update -y && apt upgrade -y && apt install nmap -y" -f 5
ubuntu | CHANGED | rc=0 >>
Hit:1 http://packages.icinga.com/ubuntu icinga-bionic InRelease
Hit:2 http://archive.ubuntu.com/ubuntu bionic InRelease
Get:3 http://archive.ubuntu.com/ubuntu bionic-updates InRelease [88.7 kB]
Get:4 http://archive.ubuntu.com/ubuntu bionic-security InRelease [88.7 kB]
Get:5 http://archive.ubuntu.com/ubuntu bionic-updates/main amd64 Packages [2165 kB]
Get:6 http://archive.ubuntu.com/ubuntu bionic-updates/main amd64 DEP-11 Metadata [294 kB]
Get:7 http://archive.ubuntu.com/ubuntu bionic-updates/universe amd64 DEP-11 Metadata [295 kB]
Get:8 http://archive.ubuntu.com/ubuntu bionic-updates/multiverse amd64 DEP-11 Metadata [2468 B]
Get:9 http://archive.ubuntu.com/ubuntu bionic-security/main amd64 DEP-11 Metadata [51.4 kB]
Get:10 http://archive.ubuntu.com/ubuntu bionic-security/universe amd64 DEP-11 Metadata [57.8 kB]
Get:11 http://archive.ubuntu.com/ubuntu bionic-security/multiverse amd64 DEP-11 Metadata [2464 B]
Fetched 3045 kB in 1s (2073 kB/s)
Reading package lists...
Building dependency tree...
Reading state information...
All packages are up to date.
Reading package lists...
Building dependency tree...
Reading state information...
Calculating upgrade...
0 upgraded, 0 newly installed, 0 to remove and 0 not upgraded.
Reading package lists...
Building dependency tree...
Reading state information...
nmap is already the newest version (7.60-1ubuntu5).
0 upgraded, 0 newly installed, 0 to remove and 0 not upgraded.
WARNING: apt does not have a stable CLI interface. Use with caution in scripts.
Finished: SUCCESS
```
---

+ ### Check online hosts & print list of this hosts

```bash
Started by user asta
Running as SYSTEM
Building in workspace /var/lib/jenkins/workspace/vsinyavski/04.Task
[04.Task] $ ansible ubuntu -i /home/vit/Work/ansible/hosts.yaml -m shell -a "nmap 192.168.201.14 192.168.202.27-28 192.168.203.27-28 178.124.206.53 > report.txt" -f 5
ubuntu | CHANGED | rc=0 >>

[04.Task] $ /bin/sh -xe /tmp/jenkins13929997932531102105.sh
+ scp root@192.168.202.28:/root/report.txt /var/lib/jenkins
Finished: SUCCESS

root@vit-comp:/var/lib/jenkins# cat report.txt 

Starting Nmap 7.60 ( https://nmap.org ) at 2021-08-06 23:24 UTC
Nmap scan report for 192.168.201.14
Host is up (0.000060s latency).
Not shown: 996 closed ports
PORT     STATE SERVICE
22/tcp   open  ssh
80/tcp   open  http
111/tcp  open  rpcbind
8080/tcp open  http-proxy
MAC Address: 66:97:E1:7F:9B:58 (Unknown)

Nmap scan report for local-centos.site (192.168.202.27)
Host is up (0.000092s latency).
Not shown: 998 filtered ports
PORT   STATE SERVICE
22/tcp open  ssh
80/tcp open  http
MAC Address: 76:00:44:2E:76:74 (Unknown)

Nmap scan report for 192.168.203.27
Host is up (0.00022s latency).
Not shown: 997 closed ports
PORT    STATE SERVICE
22/tcp  open  ssh
111/tcp open  rpcbind
179/tcp open  bgp
MAC Address: F2:C6:03:BD:3B:5B (Unknown)

Nmap scan report for 192.168.203.28
Host is up (0.00021s latency).
Not shown: 997 closed ports
PORT    STATE SERVICE
22/tcp  open  ssh
111/tcp open  rpcbind
179/tcp open  bgp
MAC Address: BE:20:5D:8E:F1:7C (Unknown)

Nmap scan report for local-ubuntu.site (192.168.202.28)
Host is up (0.0000030s latency).
Not shown: 997 closed ports
PORT    STATE SERVICE
22/tcp  open  ssh
80/tcp  open  http
111/tcp open  rpcbind

Nmap scan report for 53-206-124-178-static.mgts.by (178.124.206.53)
Host is up (0.0010s latency).
Not shown: 996 closed ports
PORT    STATE SERVICE
22/tcp  open  ssh
80/tcp  open  http
111/tcp open  rpcbind
443/tcp open  https

Nmap done: 6 IP addresses (6 hosts up) scanned in 118.90 seconds
```
---

+ ### Remove nmap

```bash
Started by user asta
Running as SYSTEM
Building in workspace /var/lib/jenkins/workspace/vsinyavski/05.Task
[05.Task] $ ansible ubuntu -i /home/vit/Work/ansible/hosts.yaml -m shell -a "apt-get purge --auto-remove nmap -y" -f 5
ubuntu | CHANGED | rc=0 >>
Reading package lists...
Building dependency tree...
Reading state information...
The following packages will be REMOVED:
  libblas3* liblinear3* nmap*
0 upgraded, 0 newly installed, 3 to remove and 0 not upgraded.
After this operation, 24.5 MB disk space will be freed.
(Reading database ... 
(Reading database ... 5%
(Reading database ... 10%
(Reading database ... 15%
(Reading database ... 20%
(Reading database ... 25%
(Reading database ... 30%
(Reading database ... 35%
(Reading database ... 40%
(Reading database ... 45%
(Reading database ... 50%
(Reading database ... 55%
(Reading database ... 60%
(Reading database ... 65%
(Reading database ... 70%
(Reading database ... 75%
(Reading database ... 80%
(Reading database ... 85%
(Reading database ... 90%
(Reading database ... 95%
(Reading database ... 100%
(Reading database ... 91782 files and directories currently installed.)
Removing nmap (7.60-1ubuntu5) ...
Removing liblinear3:amd64 (2.1.0+dfsg-2) ...
Removing libblas3:amd64 (3.7.1-4ubuntu1) ...
Processing triggers for man-db (2.8.3-2ubuntu0.1) ...
Processing triggers for libc-bin (2.27-3ubuntu1.4) ...
Finished: SUCCESS
```
  